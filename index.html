<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<title>MediaPipe ALL Demo</title>
<style>
  body {
    margin: 0;
    background: #0b0b0b;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
  }

  .wrap {
    position: relative;
    width: 960px;
    height: 720px;
  }

  video, canvas {
    position: absolute;
    width: 960px;
    height: 720px;
    border-radius: 10px;
  }
</style>
</head>
<body>

<div class="wrap">
  <video id="video" autoplay playsinline></video>
  <canvas id="canvas"></canvas>
</div>

<!-- MediaPipe -->
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>

<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js"></script>

<script>
const video = document.getElementById("video");
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

canvas.width = 960;
canvas.height = 720;

/* ================= Hands ================= */
const hands = new Hands({
  locateFile: f => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${f}`
});
hands.setOptions({
  maxNumHands: 2,
  modelComplexity: 1,
  minDetectionConfidence: 0.7,
  minTrackingConfidence: 0.7
});
hands.onResults(res => {
  if (!res.multiHandLandmarks) return;
  for (const lm of res.multiHandLandmarks) {
    drawConnectors(ctx, lm, HAND_CONNECTIONS, {color:"#00ffff", lineWidth:3});
    drawLandmarks(ctx, lm, {color:"#ff0066", lineWidth:2});
  }
});

/* ================= Face ================= */
const face = new FaceMesh({
  locateFile: f => `https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/${f}`
});
face.setOptions({
  maxNumFaces: 1,
  refineLandmarks: true,
  minDetectionConfidence: 0.7,
  minTrackingConfidence: 0.7
});
face.onResults(res => {
  if (!res.multiFaceLandmarks) return;
  for (const lm of res.multiFaceLandmarks) {
    drawConnectors(ctx, lm, FACEMESH_TESSELATION, {color:"#444"});
    drawConnectors(ctx, lm, FACEMESH_RIGHT_EYE, {color:"#00ff00"});
    drawConnectors(ctx, lm, FACEMESH_LEFT_EYE, {color:"#00ff00"});
    drawConnectors(ctx, lm, FACEMESH_LIPS, {color:"#ff0000"});
  }
});

/* ================= Pose ================= */
const pose = new Pose({
  locateFile: f => `https://cdn.jsdelivr.net/npm/@mediapipe/pose/${f}`
});
pose.setOptions({
  modelComplexity: 1,
  smoothLandmarks: true,
  minDetectionConfidence: 0.7,
  minTrackingConfidence: 0.7
});
pose.onResults(res => {
  if (!res.poseLandmarks) return;
  drawConnectors(ctx, res.poseLandmarks, POSE_CONNECTIONS,
    {color:"#ffaa00", lineWidth:4});
  drawLandmarks(ctx, res.poseLandmarks,
    {color:"#ffffff", lineWidth:2});
});

/* ================= Camera ================= */
const camera = new Camera(video, {
  width: 960,
  height: 720,
  onFrame: async () => {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

    await Promise.all([
      hands.send({image: video}),
      face.send({image: video}),
      pose.send({image: video})
    ]);
  }
});
camera.start();
</script>

</body>
</html>
